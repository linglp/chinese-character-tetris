import{w as b}from"./with-props-D3AO8slx.js";import{l as c,r as h}from"./chunk-KNED5TY2-BWNdqSdz.js";function F(){return[[1,0,0],[1,1,1],[0,0,0]]}function W(){return[[0,1,1],[0,1,0],[0,1,0]]}function $(){return[[0,0,0],[1,1,1],[0,0,1]]}function q(){return[[0,1,0],[0,1,0],[1,1,0]]}function _(){return[[1,1,0],[0,1,1],[0,0,0]]}function H(){return[[0,0,1],[0,1,1],[0,1,0]]}function K(){return[[0,0,0],[1,1,0],[0,1,1]]}function Q(){return[[0,1,0],[1,1,0],[1,0,0]]}function V(){return[[0,1,1],[1,1,0],[0,0,0]]}function X(){return[[0,1,0],[0,1,1],[0,0,1]]}function Y(){return[[0,0,0],[0,1,1],[1,1,0]]}function z(){return[[1,0,0],[1,1,0],[0,1,0]]}function ee(){return[[0,0,1],[1,1,1],[0,0,0]]}function te(){return[[0,1,0],[0,1,0],[0,1,1]]}function ne(){return[[0,0,0],[1,1,1],[1,0,0]]}function re(){return[[1,1,0],[0,1,0],[0,1,0]]}function ae(){return[[1,1,1],[1,1,1],[1,1,1]]}function oe(){return[[0,0,0],[1,1,1],[0,0,0]]}function ce(){return[[0,1,0],[0,1,0],[0,1,0]]}function se(){return[[0,1,0],[1,1,1],[0,0,0]]}function le(){return[[0,1,0],[0,1,1],[0,1,0]]}function ie(){return[[0,0,0],[1,1,1],[0,1,0]]}function ue(){return[[0,1,0],[1,1,0],[0,1,0]]}const R=["createLShape1","createLShape2","createLShape3","createLShape4","createSShape1","createSShape2","createSShape3","createSShape4","createTShape1","createTShape2","createTShape3","createTShape4","createIShape1","createIShape2","createJShape1","createJShape2","createJShape3","createJShape4","createZShape1","createZShape2","createZShape3","createZShape4","createSquareShape1"],he={createLShape1:F,createLShape2:W,createLShape3:$,createLShape4:q,createSShape1:_,createSShape2:H,createSShape3:K,createSShape4:Q,createTShape1:se,createTShape2:le,createTShape3:ie,createTShape4:ue,createIShape1:oe,createIShape2:ce,createJShape1:ee,createJShape2:te,createJShape3:ne,createJShape4:re,createZShape1:V,createZShape2:X,createZShape3:Y,createZShape4:z,createSquareShape1:ae};function A(){let n=R[Math.floor(Math.random()*R.length)];const e=he[n];return e()}const J=({disabled:n,onUpdate:e,setEndGame:t,setBoard:a,setScore:r})=>{const o=s=>{var l=A();e(l),t(!1),a(k()),r(0)};return c.jsx("button",{disabled:n,onClick:o,className:"start-game-button",children:"Start Game"})},fe=({onUpdate:n,score:e,setEndGame:t,setBoard:a,setScore:r})=>c.jsx("main",{className:"flex items-center justify-center pt-16 pb-4",children:c.jsx("div",{className:"flex-1 flex flex-col items-center gap-16 min-h-0",children:c.jsxs("header",{className:"flex flex-col items-start gap-5 w-[500px] max-w-[100vw] p-4",children:[c.jsx("div",{className:"welcome",children:"Welcome to tetris!"}),c.jsxs("div",{className:"score-container",children:["Score: ",e]}),c.jsx("div",{className:"start-button",children:c.jsx(J,{disabled:!1,onUpdate:n,setEndGame:t,setBoard:a,setScore:r})})]})})}),pe=({endGame:n,hasInitialized:e})=>{const[t,a]=h.useState(0);return h.useEffect(()=>{const r=setInterval(()=>{!n&&e?a(o=>o+1):n&&a(0)},1e3);return()=>clearInterval(r)},[n,e]),c.jsxs("div",{className:"timer",children:["Timer: ",t," s"]})},de=({onUpdate:n,setEndGame:e,setBoard:t,setScore:a})=>c.jsx("div",{className:"splash",children:c.jsxs("div",{children:[c.jsx("h1",{children:"Game Over"}),c.jsx("div",{className:"restart-btn",children:c.jsx(J,{disabled:!1,onUpdate:n,setEndGame:e,setBoard:t,setScore:a})})]})}),me=({board:n,endGame:e,setShape:t,hasInitialized:a,setEndGame:r,setBoard:o,setScore:s})=>(h.useEffect(()=>{},[n,e]),c.jsxs("div",{className:"board",children:[c.jsx(pe,{endGame:e,hasInitialized:a}),n.map((l,u)=>c.jsx("div",{className:"row",children:l.map((f,i)=>c.jsx("div",{className:`cell cell-${f}`},`${u}_${i}`))},u)),e&&c.jsx(de,{onUpdate:t,setEndGame:r,setBoard:o,setScore:s})]}));function T({board:n,shapeCoordinate:e}){const t=n.map(a=>[...a]);return e.forEach(a=>{t[a.row][a.col]=0}),t}function M({board:n,newShape:e}){const t=n.map(r=>[...r]),a=e;return e.forEach(r=>{const o=r.row,s=r.col;t[o][s]=1}),{newBoard:t,shapePos:a}}const Se=1;function we(n){if(n.length===0)return[0,0,0,0];const{maxRow:e,maxCol:t,minRow:a,minCol:r}=n.reduce((o,{row:s,col:l})=>({maxRow:Math.max(o.maxRow,s),maxCol:Math.max(o.maxCol,l),minRow:Math.min(o.minRow,s),minCol:Math.min(o.minCol,l)}),{maxRow:0,maxCol:0,minRow:100,minCol:100});return[e,t,a,r]}function xe(n,e){const t=e.length,a=e[0].length;for(const s of n){var r=s.row,o=s.col;if(r>=0&&o>=0&&r<t&&o<a&&e[r][o]===Se)return!0}return!1}function L(n,e,t,a){const r=f=>f.map(i=>({row:i.row,col:i.col-1})),o=f=>f.map(i=>({row:i.row,col:i.col+1})),s=f=>f.map(i=>({row:i.row+1,col:i.col}));let l=e,u=t;return n==="ArrowRight"?(l=o(e),u=o(t)):n==="ArrowLeft"?(l=r(e),u=r(t)):n==="ArrowDown"?(l=s(e),u=s(t)):n=="ArrowUp"&&(l=je(e,t)),a(u),l}function y({nextShape:n,board:e}){const t=e.map(r=>[...r]);return xe(n,t)}function ve(n){const e=n.map(o=>o.row),t=n.map(o=>o.col),a=(Math.min(...e)+Math.max(...e))/2,r=(Math.min(...t)+Math.max(...t))/2;return{row:a,col:r}}function je(n,e){const t=ve(e),a=t.col,r=t.row;var o=n.map(s=>({row:Math.round(r+(s.col-a)),col:Math.round(a-(s.row-r))}));return o}function I({nextShape:n,rowLimit:e,colLimit:t}){const[a,r,o,s]=we(n);return a<e&&r<t&&s>=0&&o>=0}function O(n){const e=[];return n.forEach((t,a)=>{t.forEach((r,o)=>{r===1&&e.push({row:a,col:o})})}),e}function P(n){const e=[];return n.forEach((t,a)=>{t.forEach((r,o)=>{e.push({row:a,col:o})})}),e}function Be(n,e){const t=[],a=n.map(r=>[...r]);for(let r=0;r<n.length;r++)(l=>l.every(u=>u===1))(n[r])&&t.push(r);if(t.sort((r,o)=>o-r),t.length>0){for(let o of t)a.splice(o,1);let r=n[0].length;for(let o=0;o<t.length;o++)a.unshift(Array(r).fill(0))}return e=e+10*t.length,[e,a]}function ge(n){return n[0].some(t=>t===1)}const Ce=({setShape:n,shape:e,setBoard:t,board:a,score:r,setScore:o,rowLimit:s,colLimit:l,setEndGame:u,hasInitialized:f,setHasInitialized:i})=>{const[p,S]=h.useState(O(e)),[j,B]=h.useState(P(e));return h.useEffect(()=>{if(!f&&e.length>0){console.log("restarting...");const g=L("",p,j,B),{newBoard:C,shapePos:d}=M({board:a,newShape:g});S(d),t(C),i(!0)}},[e,f,j]),h.useEffect(()=>{},[p]),h.useEffect(()=>{let g;g=setInterval(()=>{const d=L("ArrowDown",p,j,B),x=I({nextShape:d,rowLimit:s,colLimit:l}),E=T({board:a,shapeCoordinate:p}),N=y({nextShape:d,board:E});if(x&&!N){const{newBoard:m,shapePos:w}=M({board:E,newShape:d});t(m),S(w)}else{const{newBoard:m}=M({board:a,newShape:p});t(m);const w=ge(m);if(w){u(w);return}const[G,U]=Be(m,r);o(G),t(U);var v=A();n(v),B(P(v)),S(O(v)),i(!1)}},1e3);const C=d=>{d.preventDefault();const x=L(d.key,p,j,B),E=I({nextShape:x,rowLimit:s,colLimit:l}),N=T({board:a,shapeCoordinate:p}),v=y({nextShape:x,board:N});if(E&&!v){const{newBoard:m,shapePos:w}=M({board:N,newShape:x});t(m),S(w)}};return window.addEventListener("keydown",C),()=>{window.removeEventListener("keydown",C),clearInterval(g)}}),null};function Le({}){return[{title:"Let's play tetris"},{name:"description",content:"Play tetris with Chinese character"}]}const Z=15,D=10,k=()=>Array.from({length:Z},()=>Array(D).fill(0)),Ee=k(),Re=b(function(){const[e,t]=h.useState([]),[a,r]=h.useState(Ee),[o,s]=h.useState([]),[l,u]=h.useState(0),[f,i]=h.useState(!1),[p,S]=h.useState(!1);return c.jsx("div",{className:"app-container",children:c.jsxs("div",{className:"content",children:[c.jsx(fe,{onUpdate:t,score:l,setEndGame:i,setBoard:r,setScore:u}),c.jsxs("div",{className:"main-container",children:[c.jsx("div",{className:"shape-container",children:e.length>0&&c.jsx(Ce,{setShape:t,shape:e,setBoard:r,board:a,score:l,setScore:u,borderBox:o,rowLimit:Z,colLimit:D,setEndGame:i,hasInitialized:p,setHasInitialized:S})}),c.jsx(me,{board:a,endGame:f,setEndGame:i,setShape:t,hasInitialized:p,setBoard:r,setScore:u})]})]})})});export{Re as default,Le as meta};
